<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>SORCERIAN Text</title>
<link rel="stylesheet" href="./stext/zoombox.css" />
<link rel="stylesheet" href="./stext/toastr.min.css" />
<link rel="stylesheet" href="./stext/sgml.css" />
<style>#main { font-size: 16px; }</style>
<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="./stext/zoombox.js"></script>
<script src="./stext/jquery.markdown.js"></script>
<script src="./stext/toastr.min.js"></script>
<script src="./stext/vkbeautify.js"></script>
<script src="./stext/sgml.js"></script>
<script>
$(function() {
  var result = {};
  var params = location.search.substring(1).split('&');
  for(var i = 0; i < params.length; i++){
    var kv = params[i].split('=');
    result[kv[0]] = decodeURIComponent(kv[1]);
  }
  var id = result['id'];
  if(id) {
    // New Playground対応
    if (id === 'pg2') {
      $('#main').startGame(
        localStorage.getItem('pg2_run'), true);
        //localStorage.removeItem('pg2_run');
    } else {
      $('#main').startGame(id, true);
    }
  }

  $.get('./stext/stext.xml').done(function(data) {
    $('scenario > work, utility > work[backup]', data).each(function() { 
      $('#scenario').append(
        $('<option></option>').
          attr('value', $(this).attr('id')).
          text($(this).attr('title'))
      );
      $('#select_scenario').append(
        $('<option></option>').
          attr('value', $(this).attr('id')).
          text($(this).attr('title'))
      );
    }); 
  }).fail(function(xhr, status, err) {
    console.log(err);
  });

  // シナリオ選択用
  $('#select_scenario').change(function(e){
    location.href = 'index.html?id=' + $(this).val();
  });

  // ストレージデータのバックアップ／リストア（テスト用）
  $('#backup').backupData('#scenario');
  $('#restore').restoreData();
  // GBAT2STextの有効化（テスト用）
  $('#gbat').gbat2stext();
});
</script>
</head>
<body>
<div style="text-align: center;">
<select id="select_scenario">
  <option value="" selected>シナリオを選択してください</option>
  <option value="test">テストシナリオ</option>
  <option value="playground">プレイグラウンド</option>
</select>
</div>
<div id="main">
  SGML（Sorcerian Gamebook Markup Language） Initialized...
</div>
<div style="text-align: center;">
  <select id="scenario">
    <option value="all">全シナリオデータ</option>
    <option value="sorcerian_text">基本情報（実績／ボーナス）</option>
  </select>
  <input type="button" id="backup" value="バックアップ" />／
  <input type="file" id="restore" accept=".stext" value="リストア" /><br />
  <input id="gbat" type="file" accept=".gbat" multiple="multiple" /> &lt;- 変換する.gbatファイルを指定
  <br />
  <span class="socialbtn twitter">
  </span>
  <span class="socialbtn twitter_custom">
  </span>
</div>
</body>
</html>
